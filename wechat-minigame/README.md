# 合成大西瓜 - 微信小游戏版

使用原生 Canvas 和自定义物理引擎完全重写的合成大西瓜游戏。

## 功能特性

### 核心玩法
- 11 种水果，从葡萄到西瓜
- 相同水果碰撞合成更高级水果
- 合成大西瓜获得 100 分额外奖励
- 水果超过警戒线游戏结束

### 道具系统
- **锤子** 🔨：点击销毁任意水果（初始 3 个）
- **选果** 🍇：选择下一个水果（初始 2 个）
- **跳过** ⏭️：跳过当前水果（初始 5 个）
- **看广告** 🎬：观看视频获取免费道具

### 排行榜
- 好友分数排行榜
- 自动上传分数
- 支持滑动查看更多

### 音效系统
- 合成音效
- 销毁音效
- 成功音效
- 游戏结束音效

## 目录结构

```
wechat-minigame/
├── game.js                 # 小游戏入口
├── game.json               # 小游戏配置
├── project.config.json     # 项目配置
├── js/
│   ├── config.js          # 游戏配置常量
│   ├── physics.js         # 物理引擎
│   ├── renderer.js        # 渲染器
│   ├── game.js            # 游戏主类
│   ├── adSystem.js        # 广告系统
│   └── soundSystem.js     # 音效系统
├── openDataContext/        # 开放数据域（排行榜）
│   └── index.js
└── res/
    ├── images/            # 图片资源
    └── audio/             # 音效资源
        ├── merge.mp3
        ├── drop.mp3
        ├── destroy.mp3
        ├── success.mp3
        └── gameover.mp3
```

## 技术架构

### 物理引擎
自定义精简物理引擎，实现：
- 圆形刚体碰撞检测
- 重力模拟
- 弹性碰撞响应
- 摩擦力计算
- 墙壁约束

### 渲染器
Canvas 2D 渲染，包含：
- 水果渐变绘制
- 高光效果
- 合成粒子特效
- UI 组件绘制

### 碰撞合成
- 基于物理引擎碰撞对检测
- 相同等级水果合成
- 合成延迟防重复触发
- 位置和速度继承

## 部署步骤

### 1. 配置 AppID

打开 `project.config.json`，确认 appid 正确：

```json
{
  "appid": "wx19c7816c053103f0"
}
```

### 2. 配置广告位

打开 `js/config.js`，修改广告位 ID：

```javascript
const AD_CONFIG = {
    rewardedVideoAdUnitId: 'adunit-xxxxxxxxxx',  // 替换为实际 ID
    // ...
};
```

### 3. 使用微信开发者工具

1. 打开微信开发者工具
2. 选择「小游戏项目」
3. 导入 `wechat-minigame` 目录
4. 点击「编译」预览

### 4. 真机测试

1. 点击「预览」生成二维码
2. 使用微信扫码测试

## 游戏参数调整

### 水果配置

在 `js/config.js` 的 `FRUITS` 数组中调整：
- `radius`：水果大小
- `color`：水果颜色
- `score`：合成得分

### 物理参数

在 `js/config.js` 的 `PHYSICS` 对象中调整：
- `gravity`：重力大小
- `restitution`：弹性系数
- `friction`：摩擦力

### 游戏规则

在 `js/config.js` 的 `RULES` 对象中调整：
- `maxFruitLevel`：随机生成的最大水果等级
- `gameOverDelay`：超线判定延迟
- `dropCooldown`：投放冷却时间

## 隐私权限配置

排行榜功能需要在微信公众平台配置用户隐私保护指引：

1. 登录 [微信公众平台](https://mp.weixin.qq.com)
2. 进入「设置」→「用户隐私保护指引」
3. 点击「更新」填写隐私协议
4. 在接口权限中勾选以下权限：
   - `wx.getFriendCloudStorage`：获取好友云存储数据
   - `wx.setUserCloudStorage`：设置用户云存储数据

配置完成后，排行榜功能即可正常使用。

## 常见问题

### Q: 游戏黑屏？
A: 检查控制台是否有报错，确认所有 js 文件路径正确。

### Q: 广告不显示？
A: 需要在微信公众平台开通流量主并创建广告位。

### Q: 排行榜显示"需要配置隐私协议"？
A: 参考上方「隐私权限配置」章节，在微信公众平台配置用户隐私保护指引。

### Q: 排行榜无数据？
A: 需要微信授权登录，且好友也需要玩过游戏。

### Q: 模拟器中广告不播放？
A: 模拟器环境不支持真实广告，会直接发放奖励用于测试。真机测试时会正常播放广告。

## 许可证

MIT License
