# åˆæˆå¤§è¥¿ç“œ - æ¸¸æˆé€»è¾‘æ–‡æ¡£

> æœ¬æ–‡æ¡£è¯¦ç»†æ¢³ç†äº† daxigua é¡¹ç›®çš„æ‰€æœ‰æ¸¸æˆé€»è¾‘ï¼ŒåŒ…æ‹¬æ ¸å¿ƒç³»ç»Ÿã€ç‰¹æ®Šæœºåˆ¶å’Œæ‰©å±•åŠŸèƒ½ã€‚

---

## ç›®å½•

1. [é¡¹ç›®æ¶æ„](#é¡¹ç›®æ¶æ„)
2. [æ ¸å¿ƒæ¸¸æˆæœºåˆ¶](#æ ¸å¿ƒæ¸¸æˆæœºåˆ¶)
3. [ç‰©ç†å¼•æ“](#ç‰©ç†å¼•æ“)
4. [æ°´æœç³»ç»Ÿ](#æ°´æœç³»ç»Ÿ)
5. [åˆæˆé€»è¾‘](#åˆæˆé€»è¾‘)
6. [é“å…·ç³»ç»Ÿ](#é“å…·ç³»ç»Ÿ)
7. [Combo è¿å‡»ç³»ç»Ÿ](#combo-è¿å‡»ç³»ç»Ÿ)
8. [Fever ç‹‚çƒ­æ¨¡å¼](#fever-ç‹‚çƒ­æ¨¡å¼)
9. [å¤©æ°”ç³»ç»Ÿ](#å¤©æ°”ç³»ç»Ÿ)
10. [åœ°éœ‡ç³»ç»Ÿ](#åœ°éœ‡ç³»ç»Ÿ)
11. [ç‰¹æ®Šå®ä½“](#ç‰¹æ®Šå®ä½“)
12. [Buff ç³»ç»Ÿ](#buff-ç³»ç»Ÿ)
13. [æ¸²æŸ“ç³»ç»Ÿ](#æ¸²æŸ“ç³»ç»Ÿ)
14. [éŸ³æ•ˆç³»ç»Ÿ](#éŸ³æ•ˆç³»ç»Ÿ)
15. [å¹³å°é€‚é…](#å¹³å°é€‚é…)

---

## é¡¹ç›®æ¶æ„

### æ–‡ä»¶ç»“æ„

```
shared/js/
â”œâ”€â”€ config.js      # æ¸¸æˆé…ç½®å¸¸é‡
â”œâ”€â”€ game.js        # ä¸»æ¸¸æˆç±»ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”œâ”€â”€ physics.js     # ç²¾ç®€ç‰©ç†å¼•æ“
â”œâ”€â”€ renderer.js    # Canvas æ¸²æŸ“å™¨
â”œâ”€â”€ soundSystem.js # éŸ³æ•ˆç³»ç»Ÿ
â””â”€â”€ platform.js    # å¹³å°é€‚é…å±‚ï¼ˆWeb/å¾®ä¿¡å°ç¨‹åºï¼‰
```

### æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[Game ä¸»æ¸¸æˆç±»] --> B[Physics ç‰©ç†å¼•æ“]
    A --> C[Renderer æ¸²æŸ“å™¨]
    A --> D[SoundSystem éŸ³æ•ˆ]
    A --> E[Platform å¹³å°é€‚é…]
    B --> F[Config é…ç½®]
    C --> F
    D --> E
```

---

## æ ¸å¿ƒæ¸¸æˆæœºåˆ¶

### æ¸¸æˆçŠ¶æ€

```javascript
// æ¸¸æˆçŠ¶æ€å˜é‡
isRunning: boolean      // æ¸¸æˆæ˜¯å¦è¿è¡Œä¸­
isGameOver: boolean     // æ˜¯å¦æ¸¸æˆç»“æŸ
isPaused: boolean       // æ˜¯å¦æš‚åœ
score: number           // å½“å‰åˆ†æ•°
bestScore: number       // æœ€é«˜åˆ†
```

### æ¸¸æˆåŒºåŸŸé…ç½®

```javascript
GAME_AREA = {
    topMargin: 0.15,      // é¡¶éƒ¨è¾¹è·ï¼ˆç”ŸæˆåŒºåŸŸï¼‰
    bottomMargin: 0.12,   // åº•éƒ¨è¾¹è·ï¼ˆåœ°é¢ï¼‰
    sideMargin: 0.02,     // å·¦å³è¾¹è·
    groundHeight: 80,     // åœ°é¢é«˜åº¦
    wallThickness: 20     // å¢™å£åšåº¦
}
```

### æ¸¸æˆè§„åˆ™

```javascript
RULES = {
    maxFruitLevel: 4,        // éšæœºç”Ÿæˆçš„æœ€å¤§æ°´æœç­‰çº§ï¼ˆ0-4ï¼‰
    mergeDelay: 100,         // åˆæˆå»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
    gameOverLineY: 0.18,     // æ¸¸æˆç»“æŸçº¿ä½ç½®ï¼ˆç›¸å¯¹é«˜åº¦ï¼‰
    gameOverDelay: 2000,     // è¶…è¿‡çº¿åçš„åˆ¤å®šå»¶è¿Ÿ
    dropCooldown: 300        // æŠ•æ”¾å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
}
```

### æ¸¸æˆä¸»å¾ªç¯

```javascript
loop() {
    1. è®¡ç®—æ—¶é—´å·® dt
    2. æ›´æ–°ç‰©ç†ä¸–ç•Œ (world.update)
    3. å¤„ç†ç¢°æ’æ£€æµ‹ (handleCollisions)
    4. æ£€æŸ¥æ¸¸æˆç»“æŸ (checkGameOver)
    5. æ›´æ–°è‡ªåŠ¨ä¸‹è½å€’è®¡æ—¶
    6. æ£€æŸ¥ Fever æ¨¡å¼è¿‡æœŸ
    7. æ›´æ–°å¤©æ°”ç³»ç»Ÿ
    8. æ£€æŸ¥åœ°éœ‡è§¦å‘
    9. æ›´æ–°ç›²ç›’/ç‚¸å¼¹
    10. æ›´æ–°ç‰¹æ•ˆ
    11. æ¸²æŸ“ç”»é¢
    12. requestAnimationFrame ä¸‹ä¸€å¸§
}
```

---

## ç‰©ç†å¼•æ“

### æ ¸å¿ƒç±»

#### Vectorï¼ˆ2D å‘é‡ï¼‰

```javascript
class Vector {
    x, y              // åæ ‡
    add(v)            // å‘é‡åŠ æ³•
    sub(v)            // å‘é‡å‡æ³•
    mult(s)           // æ ‡é‡ä¹˜æ³•
    dot(v)            // ç‚¹ç§¯
    length()          // å‘é‡é•¿åº¦
    normalize()       // å½’ä¸€åŒ–
}
```

#### Circleï¼ˆåœ†å½¢åˆšä½“ï¼‰

```javascript
class Circle {
    position          // ä½ç½®å‘é‡
    velocity          // é€Ÿåº¦å‘é‡
    acceleration      // åŠ é€Ÿåº¦å‘é‡
    radius            // åŠå¾„
    mass              // è´¨é‡
    restitution       // å¼¹æ€§ç³»æ•°
    friction          // æ‘©æ“¦åŠ›
    frictionAir       // ç©ºæ°”é˜»åŠ›
    isSleeping        // æ˜¯å¦ä¼‘çœ 
    fruitLevel        // æ°´æœç­‰çº§
}
```

#### Rectangleï¼ˆçŸ©å½¢åˆšä½“ï¼‰

ç”¨äºå¢™å£å’Œåœ°é¢ï¼Œå§‹ç»ˆä¸ºé™æ€ç‰©ä½“ã€‚

#### Worldï¼ˆç‰©ç†ä¸–ç•Œï¼‰

```javascript
class World {
    gravity           // é‡åŠ›å‘é‡
    bodies            // æ‰€æœ‰åˆšä½“
    walls             // å¢™å£
    
    add(body)         // æ·»åŠ åˆšä½“
    remove(body)      // ç§»é™¤åˆšä½“
    update(dt)        // æ›´æ–°ç‰©ç†
    detectCollisions() // ç¢°æ’æ£€æµ‹
    resolveCollisions() // ç¢°æ’å“åº”
}
```

### ç‰©ç†å‚æ•°

```javascript
PHYSICS = {
    gravity: { x: 0, y: 1.2 },   // é‡åŠ›
    friction: 0.3,               // æ‘©æ“¦åŠ›
    frictionStatic: 0.6,         // é™æ‘©æ“¦åŠ›
    restitution: 0.05,           // å¼¹æ€§ç³»æ•°ï¼ˆä½åå¼¹ï¼‰
    frictionAir: 0.02,           // ç©ºæ°”é˜»åŠ›
    sleepThreshold: 30,          // ä¼‘çœ é˜ˆå€¼
    sleepVelocityLimit: 0.5,     // ä¼‘çœ é€Ÿåº¦é˜ˆå€¼
    positionIterations: 4,       // ä½ç½®ä¿®æ­£è¿­ä»£æ¬¡æ•°
    velocityDamping: 0.98        // é€Ÿåº¦é˜»å°¼
}
```

### ç¢°æ’æ£€æµ‹ç®—æ³•

1. **åœ†å½¢-åœ†å½¢ç¢°æ’**ï¼šæ¯”è¾ƒä¸¤åœ†å¿ƒè·ç¦»ä¸åŠå¾„å’Œ
2. **åœ†å½¢-çŸ©å½¢ç¢°æ’**ï¼šæ‰¾åˆ°çŸ©å½¢è¾¹ç•Œä¸Šè·åœ†å¿ƒæœ€è¿‘çš„ç‚¹
3. **ç¢°æ’å“åº”**ï¼šä½¿ç”¨å†²é‡æ³•å’Œä½ç½®ä¿®æ­£

---

## æ°´æœç³»ç»Ÿ

### æ°´æœé…ç½®ï¼ˆ11ç§ï¼‰

| ID | åç§° | åŠå¾„ | é¢œè‰² | åˆ†æ•° |
|----|------|------|------|------|
| 0 | è‘¡è„ | 26 | #9b59b6 | 1 |
| 1 | æ¨±æ¡ƒ | 33 | #e74c3c | 2 |
| 2 | æ©˜å­ | 40 | #e67e22 | 3 |
| 3 | æŸ æª¬ | 48 | #f1c40f | 4 |
| 4 | çŒ•çŒ´æ¡ƒ | 56 | #27ae60 | 5 |
| 5 | ç•ªèŒ„ | 64 | #c0392b | 6 |
| 6 | æ¡ƒå­ | 72 | #fd79a8 | 7 |
| 7 | è è | 82 | #fdcb6e | 8 |
| 8 | æ¤°å­ | 92 | #dfe6e9 | 9 |
| 9 | åŠè¥¿ç“œ | 102 | #00b894 | 10 |
| 10 | è¥¿ç“œ | 115 | #55a630 | 100 |

### æ°´æœç”Ÿæˆé€»è¾‘

```javascript
generateNextFruit() {
    // æ£€æŸ¥æ˜¯å¦ç”Ÿæˆç›²ç›’ï¼ˆ5%æ¦‚ç‡ï¼‰
    if (MYSTERY_BOX.enabled && Math.random() < 0.05) {
        nextIsMysteryBox = true;
        return;
    }
    
    // æ£€æŸ¥æ˜¯å¦ç”Ÿæˆå†°å°æœå®ï¼ˆ8%æ¦‚ç‡ï¼‰
    if (ICE_BLOCK.enabled && Math.random() < 0.08) {
        nextIsIceBlock = true;
        return;
    }
    
    // æ™®é€šæ°´æœï¼šéšæœºç”Ÿæˆ 0-4 çº§
    currentFruitLevel = Math.floor(Math.random() * 5);
}
```

### æ°´æœæŠ•æ”¾

```javascript
dropFruit() {
    1. æ£€æŸ¥å†·å´æ—¶é—´
    2. åˆ›å»º Circle åˆšä½“
    3. è®¾ç½®ç‰¹æ®Šå±æ€§ï¼ˆç›²ç›’/å†°å°ï¼‰
    4. æ·»åŠ åˆ°ç‰©ç†ä¸–ç•Œ
    5. æ’­æ”¾éŸ³æ•ˆ
    6. æ›´æ–°å†·å´çŠ¶æ€
    7. ç”Ÿæˆä¸‹ä¸€ä¸ªæ°´æœ
    8. é‡ç½®è‡ªåŠ¨ä¸‹è½å€’è®¡æ—¶
}
```

### è‡ªåŠ¨ä¸‹è½æœºåˆ¶

- é»˜è®¤å€’è®¡æ—¶ï¼š15ç§’
- Combo æ—¶ç¼©çŸ­ï¼šæ¯æ¬¡ combo å‡å°‘ 0.5ç§’ï¼Œæœ€ä½ 10ç§’
- å€’è®¡æ—¶ç»“æŸè‡ªåŠ¨æŠ•æ”¾å½“å‰æ°´æœ

---

## åˆæˆé€»è¾‘

### åˆæˆæ¡ä»¶

1. ä¸¤ä¸ªæ°´æœå¿…é¡»æ˜¯ `fruit` ç±»å‹
2. ä¸¤è€…ç­‰çº§ç›¸åŒ
3. ç­‰çº§ < 10ï¼ˆè¥¿ç“œä¸å¯å†åˆæˆï¼‰
4. éƒ½ä¸æ˜¯å†°å°çŠ¶æ€
5. éƒ½ä¸æ˜¯ç›²ç›’
6. éƒ½ä¸æ˜¯åˆšåˆ›å»ºçš„ï¼ˆ100mså»¶è¿Ÿï¼‰

### åˆæˆæµç¨‹

```javascript
mergeFruits(bodyA, bodyB) {
    1. è®¡ç®—æ–°ä½ç½®ï¼ˆä¸¤æœä¸­ç‚¹ï¼‰
    2. ç§»é™¤ä¸¤ä¸ªæ—§æ°´æœ
    3. åˆ›å»ºæ–°ç­‰çº§æ°´æœ
    4. ç»§æ‰¿éƒ¨åˆ†é€Ÿåº¦ï¼ˆ30%ï¼‰
    5. æ›´æ–° Combo è®¡æ•°
    6. è®¡ç®—å¸¦è¿å‡»åŠ æˆçš„åˆ†æ•°
    7. æ·»åŠ åˆæˆç‰¹æ•ˆ
    8. æ·»åŠ  Combo ç‰¹æ•ˆ
    9. æ’­æ”¾éŸ³æ•ˆ
    10. æ£€æŸ¥å†°å—è§£å†»
    11. å¦‚æœåˆæˆè¥¿ç“œï¼šé¢å¤–å¥–åŠ± + è§¦å‘ Buff é€‰æ‹©
}
```

### åˆ†æ•°è®¡ç®—

```javascript
calculateMergeScore(baseScore) {
    // è¿å‡»å€ç‡ï¼š1 + (combo-1) * 0.5
    multiplier = 1 + (comboCount - 1) * 0.5;
    return Math.floor(baseScore * multiplier);
}
```

---

## é“å…·ç³»ç»Ÿ

### é“å…·é…ç½®

| é“å…· | åˆå§‹æ•°é‡ | å¹¿å‘Šå¥–åŠ± | å›¾æ ‡ | åŠŸèƒ½ |
|------|----------|----------|------|------|
| é”¤å­ | 3 | +1 | ğŸ”¨ | é”€æ¯æŒ‡å®šæ°´æœ |
| é€‰æœ | 2 | +1 | ğŸ‡ | é€‰æ‹©ä¸‹ä¸€ä¸ªæ°´æœç±»å‹ |
| è·³è¿‡ | 5 | +2 | â­ï¸ | è·³è¿‡å½“å‰æ°´æœ |

### é”¤å­æ¨¡å¼

```javascript
activateHammer() {
    1. æ£€æŸ¥é“å…·æ•°é‡
    2. è¿›å…¥é”¤å­æ¨¡å¼
    3. ç‚¹å‡»æ°´æœæ—¶é”€æ¯
    4. æ‰£é™¤é“å…·æ•°é‡
    5. é€€å‡ºé”¤å­æ¨¡å¼
}
```

### é€‰æœåŠŸèƒ½

æ˜¾ç¤ºå…¨éƒ¨ 11 ç§æ°´æœä¾›é€‰æ‹©ï¼Œé€‰æ‹©åæ›¿æ¢å½“å‰å¾…æŠ•æ”¾æ°´æœã€‚

### è·å–é“å…·æ–¹å¼

1. **è§‚çœ‹å¹¿å‘Š**ï¼šå…è´¹è·å–é“å…·
2. **åˆ†äº«å¥½å‹**ï¼š5åˆ†é’Ÿå†·å´ï¼Œåˆ†äº«åè·å¾—é“å…·

---

## Combo è¿å‡»ç³»ç»Ÿ

### é…ç½®

```javascript
COMBO = {
    windowMs: 1500,           // Combo æœ‰æ•ˆçª—å£æ—¶é—´
    scoreMultiplier: 0.5,     // æ¯æ¬¡è¿å‡»å¢åŠ çš„åˆ†æ•°å€ç‡
    maxCombo: 20,             // æœ€å¤§è¿å‡»æ•°ä¸Šé™
    feverThreshold: 5,        // è§¦å‘ Fever æ¨¡å¼çš„è¿å‡»æ•°
    resetOnDrop: false        // æŠ•æ”¾æ–°æ°´æœæ—¶æ˜¯å¦é‡ç½®è¿å‡»
}
```

### è¿å‡»é€»è¾‘

```javascript
updateCombo() {
    if (è·ä¸Šæ¬¡åˆæˆ < 1500ms) {
        comboCount = min(comboCount + 1, 20);
    } else {
        comboCount = 1;
    }
    
    if (comboCount >= 5 && !isFeverMode) {
        activateFeverMode();
    }
}
```

### éŸ³æ•ˆå˜åŒ–

è¿å‡»æ—¶éŸ³æ•ˆ Pitch éšè¿å‡»æ•°å‡é«˜ï¼š1.0 â†’ 1.5

---

## Fever ç‹‚çƒ­æ¨¡å¼

### é…ç½®

```javascript
FEVER = {
    duration: 6000,           // æŒç»­æ—¶é—´ 6ç§’
    radiusShrink: 0.85,       // ç¢°æ’ä½“ç¼©å° 15%
    dropCooldown: 0,          // æŠ•æ”¾å†·å´å½’é›¶
    bgEffect: 'pulse',        // èƒŒæ™¯è„‰å†²ç‰¹æ•ˆ
    particleCount: 30         // ç²’å­æ•°é‡
}
```

### æ•ˆæœ

1. **ç¢°æ’ä½“ç¼©å°**ï¼šæ‰€æœ‰æ°´æœåŠå¾„ Ã— 0.85
2. **å¿«é€ŸæŠ•æ”¾**ï¼šæ— å†·å´æ—¶é—´
3. **è§†è§‰æ•ˆæœ**ï¼šæ©™çº¢è‰²è„‰å†²èƒŒæ™¯

### è§¦å‘ä¸ç»“æŸ

- **è§¦å‘æ¡ä»¶**ï¼šè¿å‡»æ•°è¾¾åˆ° 5
- **ç»“æŸæ¡ä»¶**ï¼šæŒç»­ 6 ç§’åè‡ªåŠ¨ç»“æŸ
- **ç»“æŸæ—¶æ¢å¤**ï¼šç¢°æ’ä½“æ¢å¤åŸå§‹å¤§å°ï¼Œå†·å´æ—¶é—´æ¢å¤

---

## å¤©æ°”ç³»ç»Ÿ

### é…ç½®

```javascript
WEATHER = {
    enabled: true,
    interval: 30000,          // åˆ‡æ¢é—´éš” 30ç§’
    duration: 15000,          // å•æ¬¡æŒç»­ 15ç§’
    firstDelay: 10000,        // é¦–æ¬¡è§¦å‘å»¶è¿Ÿ 10ç§’
    types: {
        windy: {...},         // å¤§é£
        slippery: {...},      // æ¢…é›¨
        icy: {...}            // éœœå†»
    }
}
```

### å¤©æ°”ç±»å‹

| å¤©æ°” | å›¾æ ‡ | æ•ˆæœ | æ¦‚ç‡ |
|------|------|------|------|
| å¤§é£ | ğŸŒªï¸ | æŒç»­æ°´å¹³æ’åŠ› 0.3 | 33% |
| æ¢…é›¨ | ğŸŒ§ï¸ | æ‘©æ“¦åŠ›é™è‡³ 0.01 | 33% |
| éœœå†» | â„ï¸ | å¼¹æ€§ç³»æ•°é™è‡³ 0.01 | 34% |

### å¤©æ°”æµç¨‹

```javascript
updateWeather() {
    if (!currentWeather && now >= nextWeatherTime) {
        startRandomWeather();
    }
    if (currentWeather && now >= weatherEndTime) {
        endWeather();
    }
    if (currentWeather === 'windy') {
        applyWindForce();  // æŒç»­æ–½åŠ é£åŠ›
    }
}
```

---

## åœ°éœ‡ç³»ç»Ÿ

### é…ç½®

```javascript
EARTHQUAKE = {
    enabled: true,
    triggerDelay: 1500,       // è¶…çº¿å 1.5ç§’è§¦å‘
    impulseStrength: 10,      // å‘ä¸Šå†²é‡å¼ºåº¦
    cooldown: 8000,           // ä¸¤æ¬¡é—´éš” 8ç§’
    screenShake: {
        duration: 600,
        intensity: 12
    }
}
```

### è§¦å‘æ¡ä»¶

å½“æ°´æœé¡¶éƒ¨è¶…è¿‡è­¦æˆ’çº¿ä¸”æŒç»­ 1.5ç§’æ—¶è§¦å‘ã€‚

### åœ°éœ‡æ•ˆæœ

```javascript
triggerEarthquake() {
    1. æ£€æŸ¥å†·å´æ—¶é—´
    2. å”¤é†’æ‰€æœ‰æ°´æœ
    3. æ–½åŠ å‘ä¸Šå†²é‡ + éšæœºæ°´å¹³æ‰°åŠ¨
    4. è§¦å‘å±å¹•éœ‡åŠ¨
    5. æ’­æ”¾éŸ³æ•ˆ
    6. æ˜¾ç¤ºè­¦å‘Šæç¤º
}
```

---

## ç‰¹æ®Šå®ä½“

### ç›²ç›’ (Mystery Box)

```javascript
MYSTERY_BOX = {
    enabled: true,
    spawnChance: 0.05,        // 5% å‡ºç°æ¦‚ç‡
    results: {
        evolve: { chance: 0.05, levelBonus: 3 },  // 5% è¿›åŒ–
        bomb: { chance: 0.10, fuseTime: 3000 },   // 10% å˜ç‚¸å¼¹
        random: { chance: 0.85, levelRange: [0, 3] }  // 85% éšæœºä½çº§
    },
    triggerDelay: 500         // è½åœ°å 0.5ç§’åˆ¤å®š
}
```

**ç›²ç›’æµç¨‹**ï¼š
1. ç”Ÿæˆæ—¶æ ‡è®°ä¸ºç›²ç›’
2. è½åœ°åå¼€å§‹è®¡æ—¶
3. ç¨³å®šåè§¦å‘æ­ç¤º
4. æ ¹æ®æ¦‚ç‡è½¬åŒ–ä¸ºï¼šé«˜çº§æ°´æœ/ç‚¸å¼¹/éšæœºæ°´æœ

### ç‚¸å¼¹ (Bomb)

```javascript
BOMB = {
    fuseTime: 3000,           // 3ç§’å¼•çˆ†
    blastRadius: 120,         // çˆ†ç‚¸å½±å“åŠå¾„
    blastForce: 15,           // çˆ†ç‚¸å†²é‡
    destroyRadius: 60,        // ç›´æ¥é”€æ¯åŠå¾„
    scoreBonus: 50,           // æ¯é”€æ¯ä¸€ä¸ªæ°´æœ +50åˆ†
    radius: 35                // ç‚¸å¼¹æ˜¾ç¤ºåŠå¾„
}
```

**çˆ†ç‚¸é€»è¾‘**ï¼š
1. 60px å†…æ°´æœç›´æ¥é”€æ¯
2. 120px å†…æ°´æœå—åˆ°å†²å‡»åŠ›
3. åŠ åˆ† = é”€æ¯æ•°é‡ Ã— 50

### å†°å°æœå® (Ice Block)

```javascript
ICE_BLOCK = {
    enabled: true,
    spawnChance: 0.08,        // 8% å‡ºç°æ¦‚ç‡
    thawRadius: 80,           // è§£å†»è§¦å‘åŠå¾„
    visualAlpha: 0.6          // å†°å±‚é€æ˜åº¦
}
```

**ç‰¹æ€§**ï¼š
- å†°å°çŠ¶æ€ä¸‹ä¸èƒ½å‚ä¸åˆæˆ
- é™„è¿‘å‘ç”Ÿåˆæˆï¼ˆ80px å†…ï¼‰æ—¶è‡ªåŠ¨è§£å†»
- è§£å†»åæ¢å¤æ­£å¸¸

---

## Buff ç³»ç»Ÿ

### è§¦å‘æ¡ä»¶

æˆåŠŸåˆæˆè¥¿ç“œæ—¶è§¦å‘ Buff é€‰æ‹©é¢æ¿ã€‚

### å¯é€‰ Buff

| Buff | å›¾æ ‡ | æ•ˆæœ | å¯å åŠ  | ä¸Šé™ |
|------|------|------|--------|------|
| æ‰©å®¹ | ğŸ“ | å®¹å™¨å®½åº¦ +10px | æ˜¯ | 5å±‚ |
| è½¯åŒ– | ğŸª¶ | é‡åŠ› -15% | æ˜¯ | 3å±‚ |
| ç²¾å‡† | ğŸ¯ | æ˜¾ç¤ºæŠ•å½±è¾…åŠ©çº¿ | å¦ | - |

### Buff é€‰æ‹©é€»è¾‘

```javascript
showBuffSelector() {
    1. æš‚åœæ¸¸æˆ
    2. éšæœºé€‰æ‹© 3 ä¸ªå¯ç”¨ Buff
    3. æ˜¾ç¤ºé€‰æ‹©é¢æ¿
    4. ç©å®¶é€‰æ‹©ååº”ç”¨æ•ˆæœ
    5. æ¢å¤æ¸¸æˆ
}
```

---

## æ¸²æŸ“ç³»ç»Ÿ

### æ¸²æŸ“å™¨åŠŸèƒ½

```javascript
class Renderer {
    // åŸºç¡€æ¸²æŸ“
    clear()                   // æ¸…ç©ºç”»å¸ƒ
    drawBackground()          // ç»˜åˆ¶èƒŒæ™¯
    drawWalls()               // ç»˜åˆ¶å¢™å£å’Œåœ°é¢
    drawGameOverLine()        // ç»˜åˆ¶è­¦æˆ’çº¿
    
    // æ°´æœæ¸²æŸ“
    drawFruit()               // ç»˜åˆ¶å•ä¸ªæ°´æœ
    drawFruits()              // ç»˜åˆ¶æ‰€æœ‰æ°´æœ
    drawPendingFruit()        // ç»˜åˆ¶å¾…æŠ•æ”¾æ°´æœ
    
    // UI æ¸²æŸ“
    drawScore()               // ç»˜åˆ¶åˆ†æ•°
    drawToolbar()             // ç»˜åˆ¶é“å…·æ 
    drawGameOver()            // ç»˜åˆ¶æ¸¸æˆç»“æŸ
    
    // ç‰¹æ•ˆæ¸²æŸ“
    drawMergeEffect()         // åˆæˆå…‰ç¯
    drawComboEffect()         // Combo æ–‡å­—
    drawExplosionEffect()     // çˆ†ç‚¸ç‰¹æ•ˆ
    drawWeatherOverlay()      // å¤©æ°”æ•ˆæœ
    drawFeverBackground()     // Fever èƒŒæ™¯
    
    // ç‰¹æ®Šå®ä½“æ¸²æŸ“
    drawMysteryBox()          // ç›²ç›’
    drawBomb()                // ç‚¸å¼¹
    drawIceFruit()            // å†°å°æ°´æœ
}
```

### æ°´æœæ¸²æŸ“ç‰¹æ•ˆ

- å¾„å‘æ¸å˜å¡«å……
- é˜´å½±æ•ˆæœ
- é«˜å…‰åå°„
- å¯çˆ±è¡¨æƒ…ï¼ˆçœ¼ç›+å¾®ç¬‘ï¼‰

---

## éŸ³æ•ˆç³»ç»Ÿ

### éŸ³æ•ˆåˆ—è¡¨

| éŸ³æ•ˆ | æ–‡ä»¶ | è§¦å‘æ—¶æœº |
|------|------|----------|
| merge | merge.mp3 | æ°´æœåˆæˆ |
| drop | drop.mp3 | æŠ•æ”¾æ°´æœ |
| destroy | destroy.mp3 | é”¤å­é”€æ¯ |
| success | success.mp3 | åˆæˆè¥¿ç“œ |
| gameOver | gameover.mp3 | æ¸¸æˆç»“æŸ |
| fever_start | success.mp3 | Fever å¼€å§‹ |
| earthquake | destroy.mp3 | åœ°éœ‡è§¦å‘ |
| explosion | destroy.mp3 | ç‚¸å¼¹çˆ†ç‚¸ |

### éŸ³æ•ˆç‰¹æ€§

- **Pitch å˜åŒ–**ï¼šåˆæˆéŸ³æ•ˆéš Combo æ•°å‡é«˜
- **éŸ³é‡æ§åˆ¶**ï¼šå…¨å±€éŸ³é‡è°ƒèŠ‚
- **é™éŸ³åŠŸèƒ½**ï¼šä¸€é”®é™éŸ³

---

## å¹³å°é€‚é…

### æ”¯æŒå¹³å°

1. **å¾®ä¿¡å°ç¨‹åº**
2. **Web æµè§ˆå™¨**

### é€‚é…å†…å®¹

| åŠŸèƒ½ | å¾®ä¿¡å°ç¨‹åº | Web |
|------|------------|-----|
| Canvas | wx.createCanvas | document.getElementById |
| è§¦æ‘¸äº‹ä»¶ | wx.onTouchXxx | addEventListener |
| å­˜å‚¨ | wx.getStorageSync | localStorage |
| éŸ³é¢‘ | wx.createInnerAudioContext | new Audio |
| åˆ†äº« | wx.shareAppMessage | Web Share API |
| æ’è¡Œæ¦œ | å¼€æ”¾æ•°æ®åŸŸ | ä¸æ”¯æŒ |

### ç¯å¢ƒæ£€æµ‹

```javascript
isWechat = typeof wx !== 'undefined' && typeof wx.getSystemInfoSync === 'function';
isWeb = typeof window !== 'undefined' && typeof document !== 'undefined' && !isWechat;
```

---

## æ¸¸æˆç»“æŸæ¡ä»¶

```javascript
checkGameOver() {
    for (æ¯ä¸ªæ°´æœ) {
        fruitTop = position.y - radius;
        // å½“æ°´æœé¡¶éƒ¨è¶…è¿‡è­¦æˆ’çº¿ä¸”é€Ÿåº¦å¾ˆæ…¢æ—¶
        if (fruitTop < gameOverLineY && velocity < 1) {
            gameOver();
        }
    }
}
```

### æ¸¸æˆç»“æŸæµç¨‹

1. è®¾ç½® `isGameOver = true`
2. æ›´æ–°æœ€é«˜åˆ†
3. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
4. ä¸Šä¼ åˆ†æ•°åˆ°æ’è¡Œæ¦œ
5. æ˜¾ç¤ºç»“æŸç”»é¢

---

## æ•°æ®å­˜å‚¨

### å­˜å‚¨é¡¹

| Key | å†…å®¹ |
|-----|------|
| daxigua_bestScore | æœ€é«˜åˆ† |
| daxigua_tools | é“å…·æ•°é‡ JSON |
| daxigua_lastShare | ä¸Šæ¬¡åˆ†äº«æ—¶é—´æˆ³ |

---

## è°ƒè¯•ç³»ç»Ÿ

### è°ƒè¯•é¢æ¿åŠŸèƒ½ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

- æ·»åŠ /æ¸…ç©ºé“å…·
- æ·»åŠ åˆ†æ•°
- è§¦å‘ Fever æ¨¡å¼
- è§¦å‘éšæœºå¤©æ°”
- è§¦å‘åœ°éœ‡
- ç”Ÿæˆç›²ç›’/ç‚¸å¼¹/å†°å°æ°´æœ
- ç”Ÿæˆéšæœºæ°´æœ
- æ¸…ç©ºæ‰€æœ‰æ°´æœ
- å¢åŠ  Combo
- å¼€å…³å¤©æ°”/åœ°éœ‡/ç›²ç›’/å†°å°ç³»ç»Ÿ

---

---

## æ–°å¢åŠŸèƒ½ (v2.0)

### ğŸ¨ å¤šçš®è‚¤ç³»ç»Ÿ

æ¸¸æˆæ”¯æŒå¤šå¥—è§†è§‰çš®è‚¤ï¼Œç©å®¶å¯è‡ªç”±åˆ‡æ¢ï¼š

| çš®è‚¤ | å›¾æ ‡ | æè¿° |
|------|------|------|
| ç»å…¸ | ğŸ‰ | åŸå§‹æ°´æœé£æ ¼ |
| æ˜Ÿçƒ | ğŸŒ | å¤ªç©ºè¡Œæ˜Ÿä¸»é¢˜ |
| ç¾é£Ÿ | ğŸ” | æ±‰å ¡é£Ÿæä¸»é¢˜ |
| æš—é»‘ | ğŸŒ™ | æ·±è‰²éœ“è™¹é£æ ¼ |

```javascript
SKINS = {
    classic: { background: {...}, ground: {...}, fruits: null },
    space: { background: {...}, ground: {...}, fruits: [...] },
    food: { background: {...}, ground: {...}, fruits: [...] },
    dark: { background: {...}, ground: {...}, fruits: [...] }
}
```

### ğŸ¯ åŠ¨æ€è½¨è¿¹é¢„æµ‹

å¯ç”¨"ç²¾å‡†"Buff åï¼Œæ˜¾ç¤ºæ°´æœä¸‹è½è½¨è¿¹é¢„æµ‹çº¿ï¼š

- è€ƒè™‘é‡åŠ›å’Œå¤©æ°”é£åŠ›å½±å“
- é¢„æµ‹ 1.5 ç§’ï¼ˆ90å¸§ï¼‰çš„è½¨è¿¹
- æ¸å˜ç²’å­æµè§†è§‰æ•ˆæœ
- æ˜¾ç¤ºé¢„æµ‹è½ç‚¹ä½ç½®

### ğŸ“Š ç‰©ç†æè´¨å·®å¼‚åŒ–

æ¯ç§æ°´æœæ‹¥æœ‰ç‹¬ç«‹çš„ç‰©ç†å±æ€§ï¼š

| æ°´æœ | æ‘©æ“¦åŠ› | å¼¹æ€§ | ç‰¹ç‚¹ |
|------|--------|------|------|
| è‘¡è„ | 0.25 | 0.15 | è½»ç›ˆå¼¹è·³ |
| æ¨±æ¡ƒ | 0.20 | 0.20 | å…‰æ»‘é«˜å¼¹ |
| çŒ•çŒ´æ¡ƒ | 0.50 | 0.03 | æ¯›èŒ¸èŒ¸ï¼Œæœ€ç¨³ |
| è è | 0.55 | 0.02 | ç²—ç³™ï¼Œè¶…ç¨³å®š |
| æ¤°å­ | 0.25 | 0.12 | ç¡¬å£³ä¸­å¼¹ |

### ğŸ“³ åˆæˆéœ‡æ„Ÿåé¦ˆ

åˆæˆæ—¶æ ¹æ®æ°´æœç­‰çº§äº§ç”Ÿä¸åŒå¼ºåº¦çš„éœ‡åŠ¨ï¼š

```javascript
MERGE_FEEDBACK = {
    baseIntensity: 2,
    levelMultiplier: 1.5,
    highLevelThreshold: 7,    // 7çº§ä»¥ä¸Šé¢å¤–åŠ å¼º
    comboHueShift: {...}      // Combo è‰²è°ƒåç§»
}
```

- **è‰²è°ƒåç§»**ï¼šè¿å‡»æ•°è¶Šé«˜ï¼Œç”»é¢è‰²å½©è¶Šé²œè‰³
- **é¥±å’Œåº¦å¢ç›Š**ï¼šæ¯æ¬¡è¿å‡»å¢åŠ  5% é¥±å’Œåº¦

### ğŸ§Š å†°å°è¿é”è§£å†»

å†°å°æœå®è§£å†»æ—¶å¯è§¦å‘è¿é”ååº”ï¼š

```javascript
ICE_BLOCK.chainReaction = {
    enabled: true,
    chainRadius: 100,        // è¿é”åŠå¾„
    chainProbability: 0.6,   // 60% è§¦å‘æ¦‚ç‡
    shockwaveForce: 3,       // å†²å‡»æ³¢åŠ›åº¦
    maxChainDepth: 3         // æœ€å¤§è¿é”æ·±åº¦
}
```

### ğŸ’« æ–°å¢ Buff

| Buff | å›¾æ ‡ | æ•ˆæœ | ç±»å‹ |
|------|------|------|------|
| ç©¿é€å¼¹ | ğŸ¯ | ä¸‹æ¬¡æŠ•æ”¾ç©¿é€é”€æ¯ 1 ä¸ªæ°´æœ | å¯å åŠ  |
| è’¸å‘ | ğŸ’¨ | æ¶ˆé™¤æ‰€æœ‰ 0-2 çº§æ°´æœ | å³æ—¶ |
| æ´—ç‰Œ | ğŸ”€ | éšæœºé‡æ’æ‰€æœ‰æ°´æœä½ç½® | å³æ—¶ |

### ğŸŒ€ å¼•åŠ›åœºï¼ˆå¾®å‹é»‘æ´ï¼‰

ç›²ç›’æœ‰ 2% æ¦‚ç‡ç”Ÿæˆå¼•åŠ›åœºï¼š

```javascript
GRAVITY_FIELD = {
    attractRadius: 150,    // å¸å¼•åŠå¾„
    attractForce: 0.5,     // å¸å¼•åŠ›
    duration: 8000,        // æŒç»­ 8 ç§’
    centerForce: 2.0       // ä¸­å¿ƒå¼ºåŒ–
}
```

- æŒç»­å¸å¼•èŒƒå›´å†…çš„æ°´æœ
- ä¸­å¿ƒåŒºåŸŸå¸å¼•åŠ›åŠ å€
- è§†è§‰èºæ—‹çº¿æ•ˆæœ

### ğŸ”® åé‡åŠ›å¤©æ°”

å¤©æ°”ç³»ç»Ÿæ–°å¢"åé‡åŠ›"ç±»å‹ï¼š

```javascript
WEATHER.types.antiGravity = {
    name: 'åé‡åŠ›',
    icon: 'ğŸ”®',
    gravityMultiplier: -0.3,  // å‘ä¸Šå¾®å¼±åŠ›
    duration: 1500,           // 1.5 ç§’çŸ­æš‚æ¼‚æµ®
    probability: 0.25
}
```

- æ‰€æœ‰æ°´æœäº§ç”Ÿæ¼‚æµ®æ•ˆæœ
- ç»“æŸåè‡ªåŠ¨å”¤é†’æ‰€æœ‰ç‰©ä½“
- ç´«è‰²ä¸Šå‡ç²’å­è§†è§‰æ•ˆæœ

### ğŸ’£ å¢å¼ºç‚¸å¼¹ç³»ç»Ÿ

ç‚¸å¼¹ç°åœ¨æœ‰æ›´å¼ºçš„å½±å“åŠ›ï¼š

```javascript
BOMB = {
    blastRadius: 180,      // å†²å‡»æ³¢åŠå¾„ï¼ˆæ‰©å¤§ï¼‰
    destroyRadius: 90,     // ç›´æ¥é”€æ¯åŠå¾„ï¼ˆæ‰©å¤§ï¼‰
    blastForce: 20,        // å†²é‡å¢å¼º
    chainReaction: true,   // ç‚¸å¼¹è¿é”å¼•çˆ†
    screenShake: {...}     // çˆ†ç‚¸éœ‡åŠ¨
}
```

### ğŸ“ˆ ç»Ÿè®¡ä¸æˆå°±ç³»ç»Ÿ

#### ç»Ÿè®¡é¡¹

- æ€»æ¸¸æˆå±€æ•°
- æ€»åˆæˆæ¬¡æ•°
- ç´¯è®¡è¥¿ç“œæ•°
- æœ€å¤§è¿å‡»æ•°
- æœ€é«˜åˆ†
- æœ€å¿«åˆæˆè¥¿ç“œæ—¶é—´
- æ€»æ¸¸æˆæ—¶é•¿

#### æˆå°±åˆ—è¡¨ï¼ˆ12ä¸ªï¼‰

| æˆå°± | æ¡ä»¶ |
|------|------|
| åˆæ¬¡åˆæˆ | é¦–æ¬¡åˆæˆå¤§è¥¿ç“œ |
| è¥¿ç“œå¤§å¸ˆ | ç´¯è®¡ 10 ä¸ªè¥¿ç“œ |
| è¥¿ç“œä¼ å¥‡ | ç´¯è®¡ 50 ä¸ªè¥¿ç“œ |
| è¿å‡»æ–°æ‰‹ | 5 è¿å‡» |
| è¿å‡»è¾¾äºº | 10 è¿å‡» |
| è¿å‡»ä¹‹ç‹ | 20 è¿å‡» |
| åƒåˆ†å¤§å…³ | å•å±€ 1000 åˆ† |
| é«˜åˆ†ç©å®¶ | å•å±€ 5000 åˆ† |
| åˆ†æ•°ç‹è€… | å•å±€ 10000 åˆ† |
| é—ªç”µæ‰‹ | 30 ç§’å†…åˆæˆè¥¿ç“œ |
| åˆæ¥ä¹åˆ° | æ¸¸ç© 10 å±€ |
| è€ç©å®¶ | æ¸¸ç© 100 å±€ |

---

## æ€»ç»“

åˆæˆå¤§è¥¿ç“œæ˜¯ä¸€æ¬¾åŸºäºç‰©ç†å¼•æ“çš„ä¼‘é—²ç›Šæ™ºæ¸¸æˆï¼Œæ ¸å¿ƒç©æ³•æ˜¯é€šè¿‡æŠ•æ”¾å’Œåˆæˆæ°´æœè·å¾—é«˜åˆ†ã€‚æ¸¸æˆåŒ…å«ä¸°å¯Œçš„ç³»ç»Ÿï¼š

1. **åŸºç¡€ç³»ç»Ÿ**ï¼šç‰©ç†å¼•æ“ã€æ°´æœåˆæˆã€é“å…·ç³»ç»Ÿ
2. **è¿›é˜¶ç³»ç»Ÿ**ï¼šCombo è¿å‡»ã€Fever æ¨¡å¼
3. **è¶£å‘³ç³»ç»Ÿ**ï¼šå¤©æ°”å˜åŒ–ã€åœ°éœ‡æœºåˆ¶ã€åé‡åŠ›å¤©æ°”
4. **ç‰¹æ®Šå®ä½“**ï¼šç›²ç›’ã€ç‚¸å¼¹ï¼ˆè¿é”çˆ†ç‚¸ï¼‰ã€å†°å°æœå®ï¼ˆè¿é”è§£å†»ï¼‰ã€å¼•åŠ›åœº
5. **æˆé•¿ç³»ç»Ÿ**ï¼šBuff é€‰æ‹©ï¼ˆ6ç§ï¼‰ã€æˆå°±ç³»ç»Ÿï¼ˆ12ä¸ªï¼‰
6. **ä¸ªæ€§åŒ–**ï¼šå¤šçš®è‚¤ç³»ç»Ÿï¼ˆ4å¥—ï¼‰
7. **æ„Ÿå®˜åé¦ˆ**ï¼šç‰©ç†æè´¨å·®å¼‚åŒ–ã€éœ‡æ„Ÿåé¦ˆã€è½¨è¿¹é¢„æµ‹

æ¸¸æˆé€šè¿‡è¿™äº›ç³»ç»Ÿçš„ç»„åˆï¼Œåˆ›é€ äº†ä¸°å¯Œçš„æ¸¸æˆä½“éªŒå’Œç­–ç•¥æ·±åº¦ã€‚
